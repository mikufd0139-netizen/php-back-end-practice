<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ§åˆ¶å° - Shop åå°</title>
    <link rel="stylesheet" href="css/admin.css">
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="admin-header">
        <a href="index.html" class="logo">ğŸ›’ Shop <span>åå°ç®¡ç†</span></a>
        <div class="user-info">
            <span class="username" id="adminName">ç®¡ç†å‘˜</span>
            <button class="logout-btn" onclick="handleLogout()">é€€å‡ºç™»å½•</button>
        </div>
    </header>

    <!-- ä¾§è¾¹æ  -->
    <aside class="admin-sidebar">
        <a href="index.html" class="menu-item active">ğŸ“Š æ§åˆ¶å°</a>
        <a href="users.html" class="menu-item">ğŸ‘¥ ç”¨æˆ·ç®¡ç†</a>
    </aside>

    <!-- ä¸»å†…å®¹ -->
    <main class="admin-main">
        <div class="page-header">
            <h1>æ§åˆ¶å°</h1>
            <p>æ¬¢è¿å›æ¥ï¼Œè¿™æ˜¯ç³»ç»Ÿæ•°æ®æ¦‚è§ˆ</p>
        </div>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card primary">
                <div class="stat-title">ç”¨æˆ·æ€»æ•°</div>
                <div class="stat-value" id="totalUsers">-</div>
            </div>
            <div class="stat-card success">
                <div class="stat-title">æ­£å¸¸ç”¨æˆ·</div>
                <div class="stat-value" id="activeUsers">-</div>
            </div>
            <div class="stat-card danger">
                <div class="stat-title">å·²ç¦ç”¨</div>
                <div class="stat-value" id="disabledUsers">-</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-title">ä»Šæ—¥æ–°å¢</div>
                <div class="stat-value" id="todayUsers">-</div>
            </div>
        </div>

        <!-- æœ€è¿‘æ³¨å†Œç”¨æˆ· -->
        <div class="card">
            <div class="card-header">
                <h2>æœ€è¿‘æ³¨å†Œç”¨æˆ·</h2>
                <a href="users.html" class="btn btn-primary btn-sm">æŸ¥çœ‹å…¨éƒ¨</a>
            </div>
            <div class="card-body">
                <div class="loading" id="loading">åŠ è½½ä¸­...</div>
                <table class="table" id="usersTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>ç”¨æˆ·å</th>
                            <th>é‚®ç®±</th>
                            <th>æ‰‹æœºå·</th>
                            <th>çŠ¶æ€</th>
                            <th>æ³¨å†Œæ—¶é—´</th>
                        </tr>
                    </thead>
                    <tbody id="usersBody">
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script src="js/admin-api.js"></script>
    <script>
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        if (!AdminAuth.requireLogin()) {
            // ä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ
        }

        // é¡µé¢åŠ è½½
        document.addEventListener('DOMContentLoaded', function() {
            loadAdminInfo();
            loadStats();
            loadRecentUsers();
        });

        // åŠ è½½ç®¡ç†å‘˜ä¿¡æ¯
        function loadAdminInfo() {
            const user = AdminAuth.getUser();
            if (user) {
                document.getElementById('adminName').textContent = user.username;
            }
        }

        // åŠ è½½ç»Ÿè®¡æ•°æ®
        async function loadStats() {
            const result = await AdminAPI.getUserCount();
            
            if (result.success) {
                document.getElementById('totalUsers').textContent = result.data.total;
                document.getElementById('activeUsers').textContent = result.data.active;
                document.getElementById('disabledUsers').textContent = result.data.disabled;
                document.getElementById('todayUsers').textContent = result.data.today;
            } else {
                // å¯èƒ½æ˜¯æœªç™»å½•æˆ–æƒé™ä¸è¶³
                if (result.message.includes('ç™»å½•') || result.message.includes('æƒé™')) {
                    AdminAuth.clearUser();
                    window.location.href = 'login.html';
                }
            }
        }

        // åŠ è½½æœ€è¿‘ç”¨æˆ·
        async function loadRecentUsers() {
            const result = await AdminAPI.getUsers(1, 5);
            
            document.getElementById('loading').style.display = 'none';
            
            if (result.success) {
                document.getElementById('usersTable').style.display = 'table';
                
                const tbody = document.getElementById('usersBody');
                tbody.innerHTML = '';
                
                result.data.users.forEach(user => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${user.id}</td>
                        <td>${user.username}</td>
                        <td>${user.email || '-'}</td>
                        <td>${user.phone || '-'}</td>
                        <td>
                            <span class="tag ${user.status === 1 ? 'tag-success' : 'tag-danger'}">
                                ${user.status_name}
                            </span>
                        </td>
                        <td>${user.created_at}</td>
                    `;
                    tbody.appendChild(tr);
                });
            }
        }

        // é€€å‡ºç™»å½•
        async function handleLogout() {
            await AdminAPI.logout();
            AdminAuth.clearUser();
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>
