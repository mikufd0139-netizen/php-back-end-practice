<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººä¸­å¿ƒ - Shop</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <a href="index.html" class="logo">ğŸ›’ Shop</a>
        <div class="nav-links" id="navLinks">
            <a href="products.html">å•†å“</a>
            <a href="cart.html">ğŸ›’ è´­ç‰©è½¦</a>
            <a href="orders.html">ğŸ“¦ è®¢å•</a>
            <a href="favorites.html">â¤ï¸ æ”¶è—</a>
            <a href="footprints.html">ğŸ‘£ è¶³è¿¹</a>
            <a href="profile.html">ğŸ‘¤ ä¸ªäººä¸­å¿ƒ</a>
            <a href="#" onclick="handleLogout()">é€€å‡º</a>
        </div>
    </nav>

    <div class="container">
        <h1>ä¸ªäººä¸­å¿ƒ</h1>
        
        <!-- åŠ è½½çŠ¶æ€ -->
        <div class="loading" id="loading">åŠ è½½ä¸­...</div>
        
        <!-- é”™è¯¯æç¤º -->
        <div class="alert alert-error" id="errorAlert"></div>

        <!-- ç”¨æˆ·ä¿¡æ¯ -->
        <div class="profile-card" id="profileCard" style="display: none;">
            <div class="avatar" id="avatar">U</div>
            
            <div class="info-item">
                <span class="info-label">ç”¨æˆ·ID</span>
                <span class="info-value" id="userId">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">ç”¨æˆ·å</span>
                <span class="info-value" id="username">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">é‚®ç®±</span>
                <span class="info-value" id="email">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">æ‰‹æœºå·</span>
                <span class="info-value" id="phone">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">æ³¨å†Œæ—¶é—´</span>
                <span class="info-value" id="createdAt">-</span>
            </div>

            <button class="btn btn-danger" style="margin-top: 30px;" onclick="handleLogout()">
                é€€å‡ºç™»å½•
            </button>

            <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid #eee;">
                <h3 style="font-size: 14px; color: #666; margin-bottom: 15px; text-align: left;">å¿«æ·å…¥å£</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <a href="cart.html" style="display:block;padding:12px;background:#f6f8fa;border-radius:8px;text-decoration:none;color:#333;text-align:center;font-size:14px;">ğŸ›’ è´­ç‰©è½¦</a>
                    <a href="orders.html" style="display:block;padding:12px;background:#f6f8fa;border-radius:8px;text-decoration:none;color:#333;text-align:center;font-size:14px;">ğŸ“¦ æˆ‘çš„è®¢å•</a>
                    <a href="addresses.html" style="display:block;padding:12px;background:#f6f8fa;border-radius:8px;text-decoration:none;color:#333;text-align:center;font-size:14px;">ğŸ“ æ”¶è´§åœ°å€</a>
                    <a href="favorites.html" style="display:block;padding:12px;background:#f6f8fa;border-radius:8px;text-decoration:none;color:#333;text-align:center;font-size:14px;">â¤ï¸ æˆ‘çš„æ”¶è—</a>
                    <a href="footprints.html" style="display:block;padding:12px;background:#f6f8fa;border-radius:8px;text-decoration:none;color:#333;text-align:center;font-size:14px;">ğŸ‘£ æµè§ˆè¶³è¿¹</a>
                    <a href="products.html" style="display:block;padding:12px;background:#f6f8fa;border-radius:8px;text-decoration:none;color:#333;text-align:center;font-size:14px;">ğŸ›’ æµè§ˆå•†å“</a>
                </div>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // é¡µé¢åŠ è½½æ—¶è·å–ç”¨æˆ·ä¿¡æ¯
        document.addEventListener('DOMContentLoaded', loadProfile);

        async function loadProfile() {
            // å…ˆæ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰ç™»å½•ä¿¡æ¯
            if (!Auth.isLoggedIn()) {
                window.location.href = 'login.html';
                return;
            }

            // ä»åç«¯è·å–æœ€æ–°çš„ç”¨æˆ·ä¿¡æ¯
            const result = await API.getProfile();

            document.getElementById('loading').style.display = 'none';

            if (result.success) {
                // æ›´æ–°æœ¬åœ°å­˜å‚¨
                Auth.setUser(result.data);
                // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
                displayProfile(result.data);
            } else {
                // è·å–å¤±è´¥ï¼ˆå¯èƒ½æ˜¯ Session è¿‡æœŸï¼‰
                showError(result.message);
                Auth.clearUser();
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
            }
        }

        function displayProfile(user) {
            document.getElementById('profileCard').style.display = 'block';
            
            // å¤´åƒæ˜¾ç¤ºç”¨æˆ·åé¦–å­—æ¯
            document.getElementById('avatar').textContent = user.username.charAt(0).toUpperCase();
            
            document.getElementById('userId').textContent = user.id || user.user_id;
            document.getElementById('username').textContent = user.username;
            document.getElementById('email').textContent = user.email || 'æœªè®¾ç½®';
            document.getElementById('phone').textContent = user.phone || 'æœªè®¾ç½®';
            document.getElementById('createdAt').textContent = user.created_at || '-';
        }

        async function handleLogout() {
            const result = await API.logout();
            Auth.clearUser();
            window.location.href = 'index.html';
        }

        function showError(message) {
            const alert = document.getElementById('errorAlert');
            alert.textContent = message;
            alert.style.display = 'block';
        }
    </script>
</body>
</html>
