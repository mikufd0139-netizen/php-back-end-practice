<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººä¸­å¿ƒ - Shop</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <a href="index.html" class="logo">ğŸ›’ Shop</a>
        <div class="nav-links">
            <a href="profile.html">ğŸ‘¤ ä¸ªäººä¸­å¿ƒ</a>
            <a href="#" onclick="handleLogout()">é€€å‡º</a>
        </div>
    </nav>

    <div class="container">
        <h1>ä¸ªäººä¸­å¿ƒ</h1>
        
        <!-- åŠ è½½çŠ¶æ€ -->
        <div class="loading" id="loading">åŠ è½½ä¸­...</div>
        
        <!-- é”™è¯¯æç¤º -->
        <div class="alert alert-error" id="errorAlert"></div>

        <!-- ç”¨æˆ·ä¿¡æ¯ -->
        <div class="profile-card" id="profileCard" style="display: none;">
            <div class="avatar" id="avatar">U</div>
            
            <div class="info-item">
                <span class="info-label">ç”¨æˆ·ID</span>
                <span class="info-value" id="userId">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">ç”¨æˆ·å</span>
                <span class="info-value" id="username">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">é‚®ç®±</span>
                <span class="info-value" id="email">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">æ‰‹æœºå·</span>
                <span class="info-value" id="phone">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">æ³¨å†Œæ—¶é—´</span>
                <span class="info-value" id="createdAt">-</span>
            </div>

            <button class="btn btn-danger" style="margin-top: 30px;" onclick="handleLogout()">
                é€€å‡ºç™»å½•
            </button>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // é¡µé¢åŠ è½½æ—¶è·å–ç”¨æˆ·ä¿¡æ¯
        document.addEventListener('DOMContentLoaded', loadProfile);

        async function loadProfile() {
            // å…ˆæ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰ç™»å½•ä¿¡æ¯
            if (!Auth.isLoggedIn()) {
                window.location.href = 'login.html';
                return;
            }

            // ä»åç«¯è·å–æœ€æ–°çš„ç”¨æˆ·ä¿¡æ¯
            const result = await API.getProfile();

            document.getElementById('loading').style.display = 'none';

            if (result.success) {
                // æ›´æ–°æœ¬åœ°å­˜å‚¨
                Auth.setUser(result.data);
                // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
                displayProfile(result.data);
            } else {
                // è·å–å¤±è´¥ï¼ˆå¯èƒ½æ˜¯ Session è¿‡æœŸï¼‰
                showError(result.message);
                Auth.clearUser();
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
            }
        }

        function displayProfile(user) {
            document.getElementById('profileCard').style.display = 'block';
            
            // å¤´åƒæ˜¾ç¤ºç”¨æˆ·åé¦–å­—æ¯
            document.getElementById('avatar').textContent = user.username.charAt(0).toUpperCase();
            
            document.getElementById('userId').textContent = user.id || user.user_id;
            document.getElementById('username').textContent = user.username;
            document.getElementById('email').textContent = user.email || 'æœªè®¾ç½®';
            document.getElementById('phone').textContent = user.phone || 'æœªè®¾ç½®';
            document.getElementById('createdAt').textContent = user.created_at || '-';
        }

        async function handleLogout() {
            const result = await API.logout();
            Auth.clearUser();
            window.location.href = 'index.html';
        }

        function showError(message) {
            const alert = document.getElementById('errorAlert');
            alert.textContent = message;
            alert.style.display = 'block';
        }
    </script>
</body>
</html>
