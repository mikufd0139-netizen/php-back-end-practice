<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¨å†Œ - Shop</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <a href="index.html" class="logo">ğŸ›’ Shop</a>
        <div class="nav-links">
            <a href="login.html">ç™»å½•</a>
            <a href="register.html">æ³¨å†Œ</a>
        </div>
    </nav>

    <div class="container">
        <h1>ç”¨æˆ·æ³¨å†Œ</h1>
        
        <!-- æç¤ºä¿¡æ¯ -->
        <div class="alert alert-error" id="errorAlert"></div>
        <div class="alert alert-success" id="successAlert"></div>

        <form id="registerForm">
            <div class="form-group">
                <label for="username">ç”¨æˆ·å <span style="color:red">*</span></label>
                <input type="text" id="username" name="username" 
                       placeholder="3-50ä¸ªå­—ç¬¦" required>
            </div>

            <div class="form-group">
                <label for="password">å¯†ç  <span style="color:red">*</span></label>
                <input type="password" id="password" name="password" 
                       placeholder="è‡³å°‘6ä½" required>
            </div>

            <div class="form-group">
                <label for="email">é‚®ç®±ï¼ˆé€‰å¡«ï¼‰</label>
                <input type="email" id="email" name="email" 
                       placeholder="example@mail.com">
            </div>

            <div class="form-group">
                <label for="phone">æ‰‹æœºå·ï¼ˆé€‰å¡«ï¼‰</label>
                <input type="tel" id="phone" name="phone" 
                       placeholder="11ä½æ‰‹æœºå·">
            </div>

            <button type="submit" class="btn btn-primary">æ³¨ å†Œ</button>
        </form>

        <p class="form-footer">
            å·²æœ‰è´¦å·ï¼Ÿ<a href="login.html">ç«‹å³ç™»å½•</a>
        </p>
    </div>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // å¦‚æœå·²ç™»å½•ï¼Œè·³è½¬åˆ°ä¸ªäººä¸­å¿ƒ
        Auth.requireGuest();

        // è¡¨å•æäº¤
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();

            hideAlerts();

            // å‰ç«¯ç®€å•éªŒè¯
            if (username.length < 3) {
                showError('ç”¨æˆ·åè‡³å°‘éœ€è¦3ä¸ªå­—ç¬¦');
                return;
            }
            if (password.length < 6) {
                showError('å¯†ç è‡³å°‘éœ€è¦6ä½');
                return;
            }

            // è°ƒç”¨æ³¨å†Œ API
            const result = await API.register(username, password, email, phone);

            if (result.success) {
                showSuccess('æ³¨å†ŒæˆåŠŸï¼å³å°†è·³è½¬åˆ°ç™»å½•é¡µ...');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 1500);
            } else {
                showError(result.message);
            }
        });

        function showError(message) {
            const alert = document.getElementById('errorAlert');
            alert.textContent = message;
            alert.style.display = 'block';
        }

        function showSuccess(message) {
            const alert = document.getElementById('successAlert');
            alert.textContent = message;
            alert.style.display = 'block';
        }

        function hideAlerts() {
            document.getElementById('errorAlert').style.display = 'none';
            document.getElementById('successAlert').style.display = 'none';
        }
    </script>
</body>
</html>
